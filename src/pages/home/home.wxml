<import src="/templates/grouponItem/grouponItem.wxml"/>
<import src="/templates/loading/loading.wxml"/>
<import src="/templates/articleItem/articleItem.wxml"/>

<template is="loading" wx:if="{{ isLoading }}"/>

<view class="container" wx:if="{{ !isLoading }}">
  

  <navigator
      class="searchWrapper"
      url="/pages/search/search"
   wx:if="{{modules[0].key=='search_box'}}" >

      <view class="search">
        <image src="/icons/search.png" class="searchIcon"/>
        <text>搜索商品，共有{{ total }}款好物</text>
      </view>
    </navigator>
  <view class="{{modules[0].key=='search_box'?'main':''}}">
    <view wx:for="{{modules}}"  wx:for-item="modules">
     <!-- 幻灯片 -->
      <view wx:if="{{modules.key=='sliders'}}">
       <swiper indicator-dots autoplay circular wx:if="{{ sliders.length }}" class="banner section" style="padding-bottom:0;height:{{modules.height}}rpx"  indicator-active-color="#56A2B8" indicator-color="#fff">
          <swiper-item wx:for="{{ sliders }}" wx:key="id">
            <button url="{{ item.path }}" bindtap="onBannerClick" data-path="{{ item.path }}">
              <image src="{{ item.image }}"/>
            </button>
          </swiper-item>
        </swiper>
      </view>
      <!-- 拼团专区 -->
      <view wx:if="{{modules.key=='groupons'}}">
        <view class="section" class="section" wx:if="{{ groupons && groupons.length }}">
          <view class="sectionTitle" wx:if="{{modules.title}}">{{modules.title}}</view>
            <navigator wx:if="{{groupons.length==1}}" url="/pages/grouponList/grouponList">
              <template is="grouponItem" data="{{ product: groupons[0] }}" />
            </navigator>
          <block wx:else>
            <navigator wx:for="{{ groupons }}" wx:key="id" class="grouponItemWrapper" url="/pages/productDetail/productDetail?id={{ item.id }}">
             <template is="grouponItem" data="{{ product: item }}"  />
            </navigator>
          </block>
          <navigator class="sectionMore" wx:if="{{groupons.length >1}}" url="/pages/grouponList/grouponList">
            <form bindsubmit="submit" report-submit="true"><button formType="submit">更多</button></form>
            <image class="rightIcon" src="/icons/right.png"/>
          </navigator>
        </view>           
      </view>
      <!-- 最新推荐 -->
      <view wx:if="{{modules.key=='articles'}}">
        <view class="section section3" wx:if="{{ articles && articles.length }}">
          <view class="sectionTitle" wx:if="{{modules.title}}">{{modules.title}}</view>
          <navigator class="m-list" wx:if="{{articles.length==1}}" url="/pages/articleList/articleList">
            <image src='{{articles[0].banner}}' style="height: {{modules.height}}rpx;"></image>
            <template is="articleItem" data="{{ article: articles[0] }}" />
          </navigator>
          <block wx:else>
            <navigator class="m-list" wx:for="{{ articles }}" wx:key="id" url="/pages/articleDetail/articleDetail?id={{ item.id }}">
              <image src='{{item.banner}}' style="height: {{modules.height}}rpx;"></image>
              <template is="articleItem" data="{{ article: item,modules:modules }}" />
            </navigator>
          </block>    
          <navigator class="sectionMore" wx:if="{{articles.length >1}}" url="/pages/articleList/articleList">
            <form bindsubmit="submit" report-submit="true"><button formType="submit">更多</button></form>
            <image class="rightIcon" src="/icons/right.png"/>
          </navigator>
        </view>
      </view>
        <!-- 限时购 -->
      <view wx:if="{{modules.key=='miaoshas'}}">
        <view class="section" wx:if="{{ miaoshas && miaoshas.length }}">
          <view class="sectionTitle" wx:if="{{modules.title}}">{{modules.title}}</view>
          <navigator wx:if="{{ miaoshas.length == 1}}" url="/pages/miaoshaList/miaoshaList">
            <flashItem  isList="{{ miaoshas.length == 1 }}"  product="{{ miaoshas[0] }}"  />
          </navigator>
          <navigator wx:if="{{ miaoshas.length > 1}}" wx:for="{{ miaoshas }}" url="/pages/productDetail/productDetail?id={{ item.id }}" wx:key="item.id" >
            <flashItem  isList="{{ miaoshas.length > 1 }}"  product="{{item }}"  />
          </navigator>
          <navigator class="sectionMore" wx:if="{{miaoshas.length >1}}" url="/pages/miaoshaList/miaoshaList">
            <form bindsubmit="submit" report-submit="true"><button formType="submit">更多</button></form>
            <image class="rightIcon" src="/icons/right.png"/>
          </navigator>
        </view>
      </view>
      <!-- 优惠券 -->
      <view wx:if="{{modules.key=='coupons'}}">
        <scroll-view class="couponsWrapper" wx:if="{{ coupons.length }}" scroll-x>
          <view class="coupons"  style="width:{{conWidth}}rpx">
            <view  class="coupon" wx:for="{{ coupons }}" wx:key="id" bindtap="onCouponClick" data-id="{{ item.id }}" data-status="{{ item.status }}" data-title="{{ item.title }}"  data-index="{{ index }}"
            >
        <form bindsubmit="submit" report-submit="true">
          <button class="couponInfoList" formType="submit">
             <view class="couponInfo">
                <view class="reduce">
                  <text wx:if="{{ item.type == 1 }}">￥</text>
                  <text class="reduceCost">{{ item.type == 1 ? item.reduce_cost : (100 - item.discount) / 10 }}</text>
                  <text wx:if="{{ item.type == 2 }}">折</text>
                </view>
                <view class="title">满{{ item.least_cost }}元使用</view>
              </view>
              <image class="bg" src="/icons/homeCoupon.png" wx:if="{{item.status == 2 && item.stock_qty }}"/>
              <image class="bg" src="/icons/homeCouponOut.png" wx:if="{{item.status == 2 && !item.stock_qty }}"/>
              <image class="bg" src="/icons/homeCouponReceived.png" wx:if="{{item.status == 4 }}"/>
              <image class="bg" src="/icons/homeCouponUsed.png" wx:if="{{item.status == 5 }}"/>

          </button>
        </form>
             
            </view>
          </view>
        </scroll-view>
      </view>
      <!-- 明星产品 -->
      <view wx:if="{{modules.key=='featured_products'}}">

        <view class="section section3" wx:if="{{ featured_products && featured_products.length }}">
          <view class="sectionTitle" wx:if="{{modules.title}}">{{modules.title}}</view>

           <navigator style="height: {{modules.height}}rpx;margin-bottom:15rpx;" url="/pages/productDetail/productDetail?id={{ item.product.id }}" wx:for="{{ featured_products }}" wx:key="item.product.id" >
              <image class="starProductItem" src="{{ item.banner }}" />
            </navigator>
        </view>
      </view>
      <!-- 最新上架 -->
      <view wx:if="{{modules.key=='products'}}">
        <view class="section" wx:if="{{ products && products.length }}">
          <view class="sectionTitle" wx:if="{{modules.title}}">{{modules.title}}</view>
          <productList products="{{ products }}" productListStyle="{{ productListStyle }}" nextCursor="{{next_cursor}}" />
          <navigator class="sectionMore" wx:if="{{products.length > 1}}" url="/pages/loadProduct/loadProduct">
           <form bindsubmit="submit" report-submit="true"><button formType="submit">更多</button></form>
           <image class="rightIcon" src="/icons/right.png"/>
         </navigator>
        </view>
      </view>
    

    <!-- 商品列表 -->
 <!--    <categoryList
      wx:if="{{ product_categories.length }}"
      categories="{{ product_categories }}"
      categoryListStyle="{{ categoryListStyle }}"
      wx:if="{{ false }}"
    /> -->

  </view>
    
  </view>
  <!-- <view class="bottomHint">-这是一条底线-</view> -->
</view>
<view class="logo">
  <image src="../../icons/hausheng.png">
  </image>
  <text>花生小店提供技术和电商支持</text>
</view>
