<!-- <page-meta page-style="overflow: {{ isShowSkuModal ? 'hidden' : 'auto' }}"> -->
<!-- 顶部程序导航 -->
<productNavigationBar id="navigation-bar" navType="productNav" showBgColor="{{ showBgColor }}" />
<scroll-view class="product-main" scroll-y="{{ true }}" enable-back-to-top>
  <!-- <van-nav-bar title="商品详情" left-text="返回" fixed="{{ true }}" placeholder="{{ true }}" left-arrow bind:click-left="onClickLeft" bind:click-right="onClickRight" /> -->
  <view class="page">
    <view class="shop-swiper">
      <swiper autoplay="{{autoplay}}" class="swiper" bindchange="currentIndex" indicator-dots="{{true}}" indicator-active-color="{{ '#DDB583'}}" indicator-color="#fff">
        <swiper-item class="swiper-box" wx:for="{{ product.images }}" wx:key="id" wx:for-item="image">
          <image class="swiper-img" src="{{ image.large }}" mode="aspectFill" data-index="{{index}}" bindtap="previewImg" />
        </swiper-item>
      </swiper>
      <!-- <view class="swiper-pageNum">
      <text lines="1" class="number">1/6</text>
    </view> -->
    </view>
    <!-- <view class="shop-time">
    <image class="time-img" src="../../icons/mvp/time-bg.png" />
    <view class="time">
      <view class="time-text">
        <text lines="1">您的手气也太好了吧</text>
        <view class="order">
          现在下单
          <text class="order-box">
            立减
            <text class="order-number">10</text>
            元
          </text>
        </view>
      </view>
      <view class="countdown">
        <view style="margin-bottom: 12rpx;">优惠结束倒计时</view>
        <van-count-down use-slot class="countdown-time" time="{{ time }}" bind:change="countdownChange">
          <text class="item">{{ timeData.hours }}</text>
          :
          <text class="item">{{ timeData.minutes }}</text>
          :
          <text class="item" style="margin-right: 0;">{{ timeData.seconds }}</text>
        </van-count-down>
      </view>
    </view>
  </view> -->
    <view class="shop-detail">
      <view class="shop-price">
        <view class="coupon">
          券后￥
          <text lines="1" wx:if="{{product && product.price}}" class="coupon-price">
            {{ product.price -  product.coupons_price }}
          </text>
          起
        </view>
        <text lines="1" class="original-price" wx:if="{{ product.coupons_price }}">
          原价￥{{product.price }}起
        </text>
      </view>
      <view lines="1" class="shop-desc">{{  product.title }}</view>
      <text lines="1" class="desc-size">{{  product.excerpt }}</text>
      <view class="line"></view>
      <view class="free-shipping">
        <text lines="1" class="shipping-text">快递：包邮</text>
        <text lines="1" class="shipping-text">销售：{{ product.sales }}</text>
        <text lines="1" class="shipping-text">库存：{{ product.stock }}</text>
      </view>
    </view>
    <!-- todo 优惠券 -->
    <!-- 优惠卷 -->
    <!-- <view class="simple-model-coupon" bind:tap="onShowCouponList">
      <van-tag custom-class="simple-coupon-tag" color="#FFF0F2" text-color="#D1483E" wx:for="{{ coupons }}" wx:key="id">
        <text>{{ item.title || '-' }}</text>
      </van-tag>
    </view> -->
    <view class="sevice-coupon" wx:if="{{ product }}">
      <block wx:if="{{ receivableCoupons.length || receivedCoupons.length }}">
        <!-- 优惠券-非拼团商品 -->
        <view wx:if="{{ !(product.groupon_enable && grouponId) }}" class="coupons" catchtap="onShowCouponList">
          <!-- <view class="couponBtn">领券</view> -->
          <!-- 可领取 最多显示三个 -->
          <block wx:if="{{ receivableCoupons.length }}">
            <view class="coupon" wx:for="{{ receivableCoupons }}" wx:for-item="item" wx:key="id" wx:if="{{ index < 2 }}">
              <view class="leftCou">
                <view>
                  <text class="money styleFont" wx:if="{{ item.type == 1 }}">
                    {{ globalData.CURRENCY[globalData.currency] }}
                  </text>
                  <text class="money styleFont" wx:if="{{ item.type == 2 }}">{{ item.discount_percent }}</text>
                  <text class="money styleFont" wx:if="{{ item.type == 2 }}">折</text>
                  <text class="money styleFont" wx:if="{{ item.type == 1 }}">{{ item.discount_amount }}</text>
                </view>
                <view class="fullText styleFont">满{{item.transaction_minimum}}元使用</view>
              </view>
              <!-- 分割线 -->
              <view class="line"></view>
              <view class="rightBtn styleFont">领取</view>
              <!-- <text>{{ item.title }}</text> -->
            </view>
          </block>
          <!-- 已领取 凑满三个 -->
          <block wx:if="{{ receivableCoupons.length < 3 && receivedCoupons.length }}">
            <view class="coupon" wx:for="{{ receivedCoupons }}" wx:key="id" wx:if="{{ index < 2 - receivedCoupons.length }}">
              <!-- <text>{{ item.title }}</text> -->
            </view>
          </block>
        </view>
        <!-- 分割线 -->
        <view class="rightPage" catchtap="onShowCouponList">
          <text class="text">共{{5}}张</text>
          <van-icon name="arrow" size="24rpx" color="#999" />
        </view>
        <!-- <view class="sevice-coupon-line" wx:if="{{ product.service_instructions && product.service_instructions.length }}"></view> -->
      </block>
    </view>
    <!-- <view class="shop-discount">
    <view class="shop-serve">
      <view lines="1" class="serve-title">服务</view>
      <view lines="2" class="serve-content">
        <view class="" selectable="false" space="false" decode="false">
          ·全场满800减60元，满1000减80元，满2000减200元；
        </view>
        <view class="" selectable="false" space="false" decode="false">·满289元享8折</view>
      </view>
    </view>
  </view> -->
    <!-- 服务说明 -->
    <view wx:if="{{ product.service_instructions && product.service_instructions.length }}" class="service">
      <view class="text">服务</view>
      <view class="desc">
        <view class="service-item" wx:for="{{ product.service_instructions }}" wx:key="item">
          • {{ item }}
        </view>
      </view>
    </view>
    <productComments wx:if="{{ config.reply_enable && product.reply_count }}" class="comments observer-tab" id="comments" comments="{{ product.replies }}" postId="{{ product.id }}" replyCount="{{ product.reply_count }}" />
    <view class="shop-text">
      <view class="text-line"></view>
      <text lines="1" class="content">商品详情</text>
      <view class="text-line"></view>
    </view>
    <view class="shop-detail-content">
      <image class="shop-detail-image" src="{{ item }}" mode="widthFix" lazy-load="false" binderror="" bindload="" wx:for="{{  product.content }}" />
    </view>
    <van-goods-action>
      <van-goods-action-icon icon="/icons/store.png" text="店铺" bind:click="onGoHome" />
      <van-goods-action-icon icon="/icons/cartSelected.png" text="购物车" bind:click="onGoCart" />
      <van-goods-action-icon icon="/icons/context.png" text="客服" open-type="{{ config.contact && config.contact.type !== 'weapp' ? '' : 'contact' }}" bind:click="onGetContact" />
      <van-goods-action-button color="{{ themeColor.secondaryColor }}" text="加入购物车" bind:click="onShowToCartSkuModal" />
      <van-goods-action-button class="def-btn" color="{{ themeColor.primaryColor }}" text="立即购买" bind:click="onShowSkuModal" />
    </van-goods-action>
    <!-- <view class="shop-button" bindtap="onShowSkuModal">
      <button size="default" class="def-btn">点我下单</button>
    </view> -->
    <!-- 优惠卷弹窗 -->
    <!-- <van-overlay show="{{ showOverlay }}">
    <view class="overlay">
      <image class="overlay-img" src="" />
      <van-icon class="overlay-close" name="close" size="64rpx" color="#ffffff" catch:tap="onClickHide" />
    </view>
  </van-overlay> -->
  </view>
</scroll-view>
<!-- </page-meta> -->
<!-- SKU -->
<skuModal isShowSkuModal="{{  isShowToCardSkuModal }}" showAddress="{{false}}" product="{{ product }}" themeColor="{{ themeColor }}" position="bottom" actions="{{ toCartActions }}" quantity="{{ product.least || 1 }}" isCrowd="{{ isCrowd }}" isGrouponBuy="{{ isGrouponBuy }}" isBargainBuy="{{isBargainBuy}}" config="{{ config }}" isIphoneX="{{ isIphoneX }}" bind:onSkuConfirm="addCart" bind:shipping-change="getShippingType" />
<skuModal isShowSkuModal="{{  isShowSkuModal }}" product="{{ product }}" themeColor="{{ themeColor }}" coupon="{{best_promotion}}" position="bottom" actions="{{ actions }}" quantity="{{ product.least || 1 }}" isCrowd="{{ isCrowd }}" isGrouponBuy="{{ isGrouponBuy }}" isBargainBuy="{{isBargainBuy}}" config="{{ config }}" isIphoneX="{{ isIphoneX }}" bind:onSkuConfirm="onSkuConfirm" bind:shipping-change="getShippingType" />
<!-- 文字弹窗 -->
<van-dialog use-slot title="" show="{{ showModalType === 'text' }}" show-cancel-button confirm-button-open-type="getUserInfo" cancel-button-color="#606266" confirm-button-color="#ffffff" class="text-modal" bind:close="onCloseModal">
  <view class="modal">
    <!-- 您有一张
    <text class="price">5元</text>
    的商家优惠券还未使用，点击确定立即使用 -->
    {{ promotion.data.text_show_content }}
  </view>
</van-dialog>
<!-- 倒计时弹窗 -->
<van-dialog use-slot title="" show="{{ showModalType === 'dialog' }}" class="countdown-modal" show-confirm-button="{{false}}" close-on-click-overlay>
  <view class="modal-content">
    <image class="modal-img" mode="widthFix" src="{{ promotion.data.dialog_image ? promotion.data.dialog_image : '../../icons/mvp/modal-bg.png' }}" />
    <view class="text" wx:if="{{ !promotion.data.dialog_image  }}">
      限时立减
      <text class="num">{{ promotion.data.discount_amount }}</text>
      元
    </view>
    <view class="modal-countdown" style="border: none">
      <van-count-down wx:if="{{ promotion.data.countdown }}" use-slot class="countdown-time" time="{{  promotion.data.countdown * 1000 }}" bind:change="countdownChange">
        <text class="time-text">剩余</text>
        <text class="item">{{ timeData.hours }}</text>
        :
        <text class="item">{{ timeData.minutes }}</text>
        :
        <text class="item">{{ timeData.seconds }}</text>
        <text class="time-text">结束</text>
      </van-count-down>
      <button class="btn" bind:tap="onCloseModal">立即下单</button>
    </view>
  </view>
</van-dialog>
<!-- 海报弹窗 -->
<view class="poster-modal" wx:if="{{ showModalType === 'poster' }}">
  <view class="countdown" wx:if="{{  promotion.data.countdown }}">
    <!-- <text class="text">30秒后失效</text> -->
    <!-- <countDown formatTime="{{  promotion.data.countdown }}" />后失效 -->
    <van-count-down time="{{  promotion.data.countdown * 1000  }}" class="vant-count-down" />
    后失效
    <!-- <van-count-down use-slot class="countdown-time" time="{{ time }}" bind:change="countdownChange">
      <text class="item">{{ timeData.hours }}</text>
      :
      <text class="item">{{ timeData.minutes }}</text>
      :
      <text class="item">{{ timeData.seconds }}</text>
    </van-count-down> -->
  </view>
  <image class="img" src="{{ promotion.data.poster_image }}" />
  <button class="btn" bind:tap="onCloseModal">领券下单</button>
</view>
<!-- 优惠卷 -->
<!-- <view class="simple-model-coupon" bind:tap="onShowCouponList">
  <van-tag custom-class="simple-coupon-tag" color="#FFF0F2" text-color="#D1483E" wx:for="{{ coupons }}" wx:key="id">
    <text>{{ item.title || '-' }}</text>
  </van-tag>
</view> -->
<!-- <van-popup show="{{ true }}" round custom-class="product-sku-wrap" custom-style="max-height: 70%" z-index="10000" bind:close="onHideOrderOptions"> -->
<!-- <orderOptions product="{{ selectedProduct }}" hasBottom titleCenter id="orderOptions" bind:add-cart="onHideOrderOptions" /> -->
<view class="def-img" wx:if="{{ showModalType === 'coupon' }}">
  <view class="modal-img">
    <image class="img-bg" src='../../icons/mvp/def-modal.png' />
    <view class="price">
      ¥
      <text class="num">{{ promotion.data.coupon.discount_amount }}</text>
    </view>
    <send-coupon bind:sendcoupon="getcoupon" bind:userconfirm="userconfirm" send_coupon_params="{{promotion.weixin_coupon_args.send_coupon_params}}" sign="{{promotion.weixin_coupon_args.sign}}" send_coupon_merchant="{{promotion.weixin_coupon_args.send_coupon_merchant}}" suggest_immediate_use="{{promotion.suggest_immediate_use}}">
      <image class="img-btn" src='../../icons/mvp/def-btn.png' />
    </send-coupon>
  </view>
</view>
<!-- 领券弹窗 -->
<van-popup show="{{ isShowCouponList }}" position="bottom" bind:close="onHideCouponList">
  <view class="actionSheet">
    <view class="actionSheetContent couponActionSheet {{ isIphoneX ? 'iphoneXTrick' : '' }}">
      <view class="close" catchtap="onHideCouponList">
        <image src="../../icons/clear.png" />
      </view>
      <scroll-view class="couponList" scroll-y>
        <view class="title">优惠券</view>
        <view class="availableCoupon">
          <view class="couponListTitle" wx:if="{{ receivableCoupons.length }}">可领取优惠券</view>
          <view class="noCoupon" wx:else>
            <image src="../../icons/noCoupon.svg"></image>
            <view>暂无可领取优惠券</view>
          </view>
          <button wx:if="{{ receivableCoupons && receivableCoupons.length }}" class="couponItemWrapper" wx:for="{{ receivableCoupons }}" wx:key="id" data-id="{{ item.id }}" data-status="{{ item.status }}" data-title="{{ item.title }}" data-index="{{ index }}" bindtap="bindGetCoupon">
            <couponList wx:if="{{ item.status == 2  }}" coupon="{{ item }}" status="receivable" config="{{config}}" />
            <!-- 未领取 -->
            <couponList wx:if="{{ item.status == 4 }}" coupon="{{ item }}" status="received" config="{{config}}" />
            <!-- 已领取 -->
          </button>
          <block wx:if="{{ receivedCoupons && receivedCoupons.length}}">
            <view class="couponListTitle">已领取优惠券</view>
            <button bindtp="bindGetCoupon" class="couponItemWrapper" wx:for="{{ receivedCoupons }}" wx:key="id" data-id="{{ item.id }}" data-status="{{ item.status }}" data-title="{{ item.title }}">
              <couponList wx:if="{{ item.status == 4 }}" coupon="{{ item }}" status="received" config="{{config}}" />
              <!-- 已领取 -->
            </button>
          </block>
        </view>
        <view class="gap" />
      </scroll-view>
    </view>
  </view>
</van-popup>
<!-- </van-popup> -->